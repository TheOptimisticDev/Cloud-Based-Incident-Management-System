<div class="panel panel-default" data-ng-controller="AirbnbIntegrationController as airbnb" data-ng-init="airbnb.init(integration)">
    <div class="panel-heading">
        <button type="button" class="pull-right btn btn-default btn-sm" data-ng-click="airbnb.syncNow()">Sync now</button>
        <h3 class="panel-title">
            <span data-ng-bind="integration.platform" class="text-capitalize"></span> settings
        </h3>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label>Airbnb id:</label>
                    <span>{{integration.id}}</span>
                </div>
                <div class="form-group">
                    <label><i class="fa fa-envelope"></i> Incoming email</label>
                    <input type="email" class="form-control" data-ng-model="integration.incomingEmail" required name="incomingEmail" data-ng-pattern="/\@(user\.guesty|superhostuser)\.com$/" data-ng-disabled="integration.active" data-ng-change="airbnb.verifyIncomingEmailAvailability(frmIntegration.incomingEmail, integration)">
                    <div class="help-block text-danger" data-ng-if="frmIntegration.incomingEmail.$error.pattern">This must be our email: @user.guesty.com</div>
                    <div class="help-block text-danger" data-ng-if="frmIntegration.incomingEmail.$error.taken">Email is already being used.</div>
                    <div class="help-block" data-ng-if="integration.active">
                        Changing the incoming email of a connected user can be tricky. We don't currently support it. Advise with Koby.
                    </div>
                    <div class="help-block" data-ng-if="!integration.active">
                        To activate, we need to receive an email from Airbnb to this address or to have working credentials.
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fa fa-user"></i> Username</label>
                    <input type="email" class="form-control" data-ng-model="integration.credentials.username" name="username" data-ng-disabled="integration.active">
                    <div class="help-block" data-ng-if="!integration.connectedAt">Leave blank to set automatically when connected.</div>
                    <div class="help-block" data-ng-if="integration.active">
                        Changing the username of a connected user can be tricky. We don't currently support it. Advise with Koby.
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fa fa-lock"></i> Password</label>
                    <div class="input-group">
                        <input type="text" class="form-control" data-ng-model="integration.credentials.password" minlength="3">
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-primary" data-ng-click="airbnb.resetPassword()" data-ng-disabled="airbnb.isIntegrationSyncing">Sync <i data-ng-if="airbnb.isIntegrationSyncing" class="fa fa-spinner fa-spin"></i></button>
                        </span>
                    </div>
                    <div class="help-block" data-ng-if="!integration.connectedAt">Leave blank to set to a random password when connected.</div>
                </div>

                <!--<div class="form-group" data-ng-if="airbnb.isInProxyMode(frmIntegration)">
                    <h3>Proxy email mode <small>(When our email is not on Airbnb)</small></h3>
                    <p>In this mode we can't know if the integration is connected or disconnected.</p>
                    <button role="button" data-ng-if="integration.active">Mark as <span class="text-danger">disconnected</span></button>
                    <button role="button" data-ng-if="!integration.active">Mark as <span class="text-success">connected</span></button>
                </div>-->
            </div>
            <div class="col-md-6">
                <div data-ng-if="!integration.connectedAt" class="alert alert-info">
                    Email forwarding is set automatically when connected.
                </div>
                <div data-ng-if="integration.connectedAt">
                    <div class="alert alert-warning" data-ng-if="integration.incomingEmail !== integration.credentials.username">
                        Integration is set with a proxy email (the user forwards us the emails, instead of having our email on Airbnb). With this setting it doesn't make sense to forward the emails back to the user.
                    </div>
                    <div class="form-group">
                        <label>Forward emails to:</label>
                        <span data-ng-if="!integration.forwardEmails.emails || !integration.forwardEmails.emails.length">
                            <strong>User's default outgoing emails</strong> ({{account.emailsTo.join(', ')}})
                        </span>
                        <span data-ng-if="integration.forwardEmails.emails.length" data-ng-bind="integration.forwardEmails.emails.join(', ')"></span>
                    </div>
                    <div class="form-group">
                        Forward all emails:
                        <span class="label label-success" data-ng-if="integration.forwardEmails.all">Yes</span>
                        <span class="label label-danger" data-ng-if="!integration.forwardEmails.all">No</span>
                    </div>
                    <div data-ng-if="!integration.forwardEmails.all">
                        <div class="form-group">
                            Forward confirmations:
                            <span class="label label-success" data-ng-if="integration.forwardEmails.confirmations">Yes</span>
                            <span class="label label-danger" data-ng-if="!integration.forwardEmails.confirmations">No</span>
                        </div>
                        <div class="form-group">
                            Forward payment statements:
                            <span class="label label-success" data-ng-if="integration.forwardEmails.payments">Yes</span>
                            <span class="label label-danger" data-ng-if="!integration.forwardEmails.payments">No</span>
                        </div>
                        <div class="form-group">
                            Forward reservation requests:
                            <span class="label label-success" data-ng-if="integration.forwardEmails.requests">Yes</span>
                            <span class="label label-danger" data-ng-if="!integration.forwardEmails.requests">No</span>
                        </div>
                        <div class="form-group">
                            Forward reminders:
                            <span class="label label-success" data-ng-if="integration.forwardEmails.reminders">Yes</span>
                            <span class="label label-danger" data-ng-if="!integration.forwardEmails.reminders">No</span>
                        </div>
                        <div class="form-group">
                            Forward reviews:
                            <span class="label label-success" data-ng-if="integration.forwardEmails.reviews">Yes</span>
                            <span class="label label-danger" data-ng-if="!integration.forwardEmails.reviews">No</span>
                        </div>
                        <div class="form-group">
                            Forward external emails from guests:
                            <span class="label label-success" data-ng-if="integration.forwardEmails.emailsFromGuest">Yes</span>
                            <span class="label label-danger" data-ng-if="!integration.forwardEmails.emailsFromGuest">No</span>
                        </div>
                        <div class="form-group">
                            Forward external emails not from guests:
                            <span class="label label-success" data-ng-if="integration.forwardEmails.externals">Yes</span>
                            <span class="label label-danger" data-ng-if="!integration.forwardEmails.externals">No</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Forward emails that the user gets as a guest to: (these are always forwarded)</label>
                        <input type="email" class="form-control" data-ng-model="integration.forwardEmails.asGuest" name="fwdEmailAsGuest">
                    </div>
                    <div class="panel panel-default" data-ng-if='integration.airbnb.ignored.listings.length > 0'>

                        <div class="panel-heading ">Ignored listings ({{integration.airbnb.ignored.listings.length}})</div>
                        <div class='panel-body ignored-listing'>
                            <div class='item' data-ng-repeat="ignoredNumber in integration.airbnb.ignored.listings">
                                {{ignoredNumber}}
                                <i data-ng-click='airbnb.showWarningForDeletingIgnoredListing(integration.airbnb.ignored.listings,ignoredNumber)' class="fa fa-trash-o"></i>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>