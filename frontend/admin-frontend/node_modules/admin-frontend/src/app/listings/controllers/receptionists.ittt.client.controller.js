'use strict';

// listings preferences controller
angular.module('listings').controller('ListingReceptionistsItttController', [
	'$scope',
    '$uibModal',
    'notify',
	function($scope, $uibModal, notify) {

        $scope.openItem = function($index, item, frm){
            $uibModal.open({
                size: 'lg',
                templateUrl: 'app/listings/views/listing/receptionists/ittt.modal.client.view.html',
                controller: 'ListingReceptionistsItttModalController as itttCtrl',
                resolve: {
                    ittt: function() {
                        return item;
                    }
                }
            }).result.then(function(result){
                if (!result.ifThis && !result.thenThat){
                    result.action = 'delete';
                }

                if (result.action === 'delete'){
                    $scope.listing.receptionistsService.receptionDesk.ittt.splice($index, 1);
                    frm.$setSubmitted();
                    $scope.saveForm(frm, ['receptionistsService.receptionDesk.ittt']);
                } else if (result.action === 'update'){
                    $scope.listing.receptionistsService.receptionDesk.ittt[$index].ifThis = result.ifThis;
                    $scope.listing.receptionistsService.receptionDesk.ittt[$index].thenThat = result.thenThat;
                    frm.$setSubmitted();
                    $scope.saveForm(frm, ['receptionistsService.receptionDesk.ittt']);
                } else {
                    notify({message:'Error', classes: 'alert-danger'});
                }
            });
        };

        $scope.addNewItem = function(frm){
            if (!_.get($scope.listing, 'receptionistsService.receptionDesk.ittt')){
                _.set($scope.listing, 'receptionistsService.receptionDesk.ittt', []);
            }
            var item = {
                item: 'New item'
            };
            $scope.listing.receptionistsService.receptionDesk.ittt.push(item);
            $scope.openItem($scope.listing.receptionistsService.receptionDesk.ittt.length-1, item, frm);
        };
	}
]);
