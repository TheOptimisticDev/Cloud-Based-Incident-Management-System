'use strict';

// listings preferences controller
angular.module('listings').controller('ListingReceptionistsScreeningController', [
	'$scope',
	function($scope) {

        $scope.addedPreBookingItem = function($event, frm){
            var newItem = $event.currentTarget.innerText;

            //is there anything to add?
            if (!newItem) {
                return;
            }
            //first init?
            if (!_.get($scope.listing, 'receptionistsService.screening.checklist')){
                _.set($scope.listing, 'receptionistsService.screening.checklist', []);
            }
            //unique validation
            if (_.find($scope.listing.receptionistsService.screening.checklist, {'item': newItem})){
                $event.currentTarget.innerText = '';
                return;
            }
            //add new item
            $scope.listing.receptionistsService.screening.checklist.push({
                item: newItem
            });

            //clean
            $event.currentTarget.innerText = '';

            if (frm){
                frm.$setDirty();
            }
        };

        $scope.editedPreBookingItem = function($index, $event, frm){
            $scope.listing.receptionistsService.screening.checklist[$index].item = $event.currentTarget.innerText;
            if ($event.currentTarget.innerText === ''){
                $scope.listing.receptionistsService.screening.checklist.splice($index, 1);
            }

            if (frm){
                frm.$setDirty();
            }
        };

	}
]);
