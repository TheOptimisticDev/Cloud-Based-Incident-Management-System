<div data-ng-controller="ListingSmartRulesController as listingRules" data-ng-init="listingRules.init()">
    <form name="form" data-ng-submit="listingRules.save(form)" data-ng-if="listingRules.listing.$resolved">
        <div class="page-header">
            <div class="pull-right" data-ng-show="form.$dirty">
                <small class="text-warning">Changes were made</small>
                <small class="text-danger" data-ng-show="form.$invalid">Form has errors.</small>
                <button class="btn btn-save" type="submit" data-ng-disabled="form.$invalid"><i class="fa fa-save"></i> Save</button>
            </div>
            <h1>
                <button type="button" class="btn btn-primary pull-right" ng-click="openLogModal('calendar smart rules')" title="logs"><i class="fa fa-history"></i></button>
                <span>Smart Rules</span>
            </h1>
            <div class="form-group">
                Active:
                <label class="switch switch-primary force">
                    <input class="switch-input" type="checkbox" data-ng-model="listingRules.listing.pms.automation.calendarSmartRules.active" data-ng-change="listingRules.toggleCalendarRulesFeature()">
                    <span class="switch-label" data-off="No" data-on="Yes"></span>
                    <span class="switch-handle"></span>
                </label>
            </div>
        </div>

        <div class="form-group">
            <label>When this listing is booked, system should block same dates for the listings:</label>
            <ui-select multiple ng-model="listingRules.selectedListings" class="with-pics">
                <ui-select-match placeholder="None">
                    <span data-ng-bind="$item.nickname || $item.title || 'Untitled'" title="{{$item.address.full}}"></span>
                </ui-select-match>
                <ui-select-choices repeat="item in listingRules.listings"
                                   refresh="listingRules.loadListings($select.search)"
                                   refresh-delay="250">
                    <img class="pull-right" data-ng-if="item.picture.thumbnail" data-ng-src="{{item.picture.thumbnail}}">
                    <div class="truncate">
                        <span data-ng-if="item.nickname" class="label label-info" data-ng-bind="item.nickname"></span>
                        <strong data-ng-bind="item.title"></strong>
                    </div>
                    <div class="truncate" data-ng-bind="item.address.full"></div>
                </ui-select-choices>
            </ui-select>
        </div>
    </form>
</div>
