<div class="row" data-ng-controller="ListingController">
    <div class="col-sm-3 col-md-2 sidebar">
        <div data-ng-show="account.$resolved">
            <!-- account -->
            <div class="nav-sidebar sidebar-title sidebar-customer-information text-center">
                <a data-ui-sref="account.settings({accountId: account._id})">
                    <strong class="small">{{account.name}}</strong>
                </a>
            </div>

            <div class="nav-sidebar sidebar-title sidebar-customer-information text-center">
                <a data-ui-sref="account.listings({accountId: account._id})">
                    <small><i class="fa fa-chevron-left"></i> Other listings in account</small>
                </a>
            </div>

            <!-- account warnings -->
            <div data-ng-if="account.active" class="nav-sidebar nav-sidebar-success sidebar-title sidebar-customer-information text-center">
                <small>Active</small>
            </div>
            <div data-ng-if="!account.active" class="nav-sidebar nav-sidebar-danger sidebar-title sidebar-customer-information text-center">
                <small>Inactive</small>
            </div>
        </div>

        <div data-ng-show="listing.$resolved">
            <!-- listing -->
            <div class="nav-sidebar sidebar-title sidebar-customer-information text-center">
                <div class="text-strong small"  title="{{listing.title}}" data-ng-bind="listing.title"></div>
                <div class="label label-info" data-ng-bind="listing.nickname"></div>
            </div>

            <!-- listing warnings -->
            <div data-ng-if="!listing.active || !listing.isListed || listing.isVirtual" class="nav-sidebar sidebar-title text-center">
                <div data-ng-if="!listing.active" class="label label-danger">Inactive</div>
                <div data-ng-if="!listing.isListed" class="label label-danger">Not Listed</div>
                <div data-ng-if="listing.isVirtual" class="label label-special1">Virtual</div>
            </div>

            <!-- listing picture -->
            <div class="nav-sidebar sidebar-title text-center">
                <img data-ng-src="{{listing.picture.thumbnail}}" ng-click="openGallery(listing)">
            </div>
        </div>

        <!-- nav -->
        <ul class="nav nav-sidebar">
            <li data-ng-repeat="item in listingSidebar.items" data-ng-class="{'divider': (item.type==='divider'), 'active': $state.includes(item.activeState)}">
                <a data-ng-if="item.state" data-ui-sref="{{item.state}}">
                    <i data-ng-class="item.icon"></i>
                    <span class="small" data-ng-bind="item.title"></span>
                </a>
            </li>
        </ul>
    </div>

    <!-- main view -->
    <div data-ng-if="listing.$resolved" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <div class="heading-bar">
            <div class="pull-right">
                <div class="form-group text-right">
                    <a class="btn btn-default" data-ng-repeat="integration in listing.integrations" title="{{integration.platform}}" data-ng-href="{{integration.externalUrl}}" target="_blank">
                        <span data-ng-bind="integration.nickname"></span>
                        <span data-ng-bind="integration.platform"></span>
                    </a>
                </div>
                <div>
                    <span class="label label-warning label-sm" data-ng-bind="listing.roomType"></span>
                    <span data-ng-if="listing.accommodates" class="label label-warning label-sm">Max <span data-ng-bind="listing.accommodates"></span> Guests</span>
                    <span data-ng-if="listing.bedrooms" class="label label-warning label-sm"><span data-ng-bind="listing.bedrooms"></span> Bedrooms</span>
                    <span data-ng-if="listing.beds" class="label label-warning label-sm"><span data-ng-bind="listing.beds"></span> Beds</span>
                </div>
            </div>
            <h2>
                <span data-ng-bind="listing.address.full"></span>
                <a title="Google Maps" data-ng-href="https://www.google.com/maps/place/{{listing.address.searchable}}" target="_blank" class="btn btn-default"><i class="fa fa-map-marker"></i></a>
                <a title="Yelp" data-ng-href="http://www.yelp.com/search?find_desc=&sortby=rating&find_loc={{listing.address.searchable}}" target="_blank" class="btn btn-default"><i class="fa fa-yelp"></i></a>
                <a title="Weather" data-ng-href="http://forecast.io/#/f/{{listingBox.listing.address.lat}},{{listingBox.listing.address.lng}}" target="_blank" class="btn btn-default"><i class="fa fa-cloud"></i></a>
            </h2>
            <h1>
                <span data-ng-bind="listing.title"></span>
                <span data-ng-if="listing.nickname" class="label label-info" data-ng-bind="listing.nickname"></span>
            </h1>

            <div class="sync-in-progress" data-ng-if="listing.pendingTasks.length">
                <h3>Sync status history:   <span>{{listing.pendingTasks.length}} tasks performed</span></h3>

                <div class="over-it">
                <ul>
                    <li data-ng-repeat="task in listing.pendingTasks">
                       <div class="sync-start-time"> <span data-ng-bind="task.createdAt|date:'short'"></span></div>
                        <div class="sync-platform" data-ng-bind="task.platform"></div>
                        <div class="task-description" data-ng-bind="task.description"></div>
                        <div data-ng-if="task.error" class="text-danger"><i class="fa fa-warning"></i> {{task.error}}</div>
                    </li>
                </ul>
                </div>
            </div>
        </div>

        <div data-ui-view></div>
    </div>
</div>
