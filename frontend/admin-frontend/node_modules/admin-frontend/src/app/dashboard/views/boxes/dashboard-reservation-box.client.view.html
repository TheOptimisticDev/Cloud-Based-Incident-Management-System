<div data-ng-controller="DashboardReservationBoxController as reservationBox" data-ng-init="reservationBox.init()">
    <div class="dashboard-box" data-ng-if="reservationBox.reservation">
        <div class="dashboard-box-icon">
            <i class="fa fa-bookmark"></i>
        </div>
        <div class="dashboard-box-loader" data-ng-if="!reservationBox.reservation.$resolved">
            <img data-ng-if="!reservationBox.hasError" src="/app/core/img/loaders/loader.gif" alt="Loading"><span></span>
            <div data-ng-if="reservationBox.hasError">Error. Report to Jira with ticket url.</div>
        </div>
        <div class="dashboard-box-content" data-ng-if="reservationBox.reservation.$resolved">
            <div class="dashboard-box-header">
                <span class="label label-info" data-ng-if="reservationBox.reservation.instantBook">instant book</span>
                <span class="label label-success" data-ng-if="reservationBox.reservation.isReturningGuest">Returning guest</span>
                <span class="label label-info" data-ng-if="reservationBox.reservation.preApproveState">Pre Approved</span>
                <span class="label label-info" data-ng-if="reservationBox.reservation.review.hasGuestReviewed">Guest Already Reviewed</span>
			<span class="label label-warning" data-ng-if="reservationBox.reservation.nightsCount">
				<span data-ng-bind="reservationBox.reservation.nightsCount"></span> Days
			</span>
			<span class="label label-warning" data-ng-if="reservationBox.reservation.guestsCount">
				<span data-ng-bind="reservationBox.reservation.guestsCount"></span> Guests
			</span>
            </div>
            <div class="dashboard-box-body">
                <div class="big-payout-notice" data-ng-if="reservationBox.reservation.money.hostPayoutUsd>3000">
                    <strong><i class="fa fa-money"></i> Big Payout Notice:</strong>
                    $<span data-ng-bind="reservationBox.reservation.money.hostPayoutUsd.toFixed(0) || 0"></span>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="pull-right" data-ng-if="!reservationBox.reservation.review.hostReview">
                            <strong>Should Review:</strong>
                            <label class="switch switch-primary force">
                                <input class="switch-input" value="1" type="checkbox" data-ng-model="reservationBox.reservation.review.shouldReview" data-ng-change="reservationBox.shouldReview()">
                                <span class="switch-label" data-off="No" data-on="Yes"></span>
                                <span class="switch-handle"></span>
                            </label>
                        </div>
                        <h3 class="capitalize" data-ng-bind="reservationBox.reservation.status"></h3>
                        <small data-ng-if="reservationBox.reservation.confirmationCode" data-ng-bind="reservationBox.reservation.confirmationCode"></small>
                        <div>(
                            <span ng-if="reservationBox.reservation.integration.platform.toLowerCase()!==reservationBox.reservation.source.toLowerCase()">{{reservationBox.reservation.integration.platform}} :</span>
                            {{reservationBox.reservation.source}}
                            )</div>
                    </div>
                    <div class="col-md-6 text-right" data-ng-if="reservationBox.reservation.status === 'reserved' && reservationBox.reservation.reservedExpiresAt">
                        <h6 class="text-danger">
                            Expires in: <timer end-time="reservationBox.reservation.reservedExpiresAt">{{hhours}}:{{mminutes}}:{{sseconds}}</timer>
                        </h6>
                    </div>
                <div data-ng-if="reservationBox.reservation.canceledBy" class="text-danger">
                        Was reservation. Canceled by {{reservationBox.reservation.canceledBy}} at {{reservationBox.reservation.canceledAt | date:'short'}}
                    </div>
                </div>
                <div class="dashboard-reservation-box-dates-container" data-ng-if="reservationBox.reservation.checkIn && reservationBox.reservation.checkOut">
                    <div class="text-center lead">
                        <span data-ng-bind="reservationBox.reservation.checkInDateLocalized | date:'(EEE) MMMM dd'" title="{{reservationBox.reservation.checkInDateLocalized | date:'yyyy'}}"></span>
                        <a href="#" editable-bstime="reservationBox.reservation.withTimezone.checkIn" e-show-meridian="false" e-minute-step="10" onaftersave="reservationBox.updateCheckInOrCheckOutTime()">
                            <span data-ng-bind="reservationBox.reservation.withTimezone.checkInTime"></span>
                        </a>
                        <span> - </span>
                        <span data-ng-bind="reservationBox.reservation.checkOutDateLocalized | date:'(EEE) MMMM dd'" title="{{reservationBox.reservation.checkInDateLocalized | date:'yyyy'}}"></span>
                        <a href="#" editable-bstime="reservationBox.reservation.withTimezone.checkOut" e-show-meridian="false" e-minute-step="10" onaftersave="reservationBox.updateCheckInOrCheckOutTime()">
                            <span data-ng-bind="reservationBox.reservation.withTimezone.checkOutTime"></span>
                        </a>
                        <div data-ng-if="reservationBox.reservationTime === 'upcoming'">
                            (Check in is <span am-time-ago="reservationBox.reservation.checkIn"></span>)
                        </div>
                        <div data-ng-if="reservationBox.reservationTime === 'currently-hosting'">
                            (Check in was <span am-time-ago="reservationBox.reservation.checkIn"></span>)
                        </div>
                        <div data-ng-if="reservationBox.reservationTime === 'past'">
                            (Check out was <span am-time-ago="reservationBox.reservation.checkOut"></span>)
                        </div>
                    </div>
                </div>
            </div>
            <div class="dashboard-box-footer">
                <div class="btn-group btn-group-justified">
                    <div class="btn-group dropdown" data-ng-if="reservationBox.reservation.money" uib-dropdown>
                        <button class="btn btn-default dropdown-toggle" type="button" uib-dropdown-toggle>
                            <i class="fa fa-usd"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" uib-dropdown-menu>
                            <li>
                                <a>Accommodation fare: <span data-ng-bind="(reservationBox.reservation.money.fareAccommodation || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Nightly rate: <span data-ng-bind="((reservationBox.reservation.money.fareAccommodation || 0)/reservationBox.reservation.nightsCount) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Cleaning fare: <span data-ng-bind="(reservationBox.reservation.money.fareCleaning || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Sub total: <span data-ng-bind="(reservationBox.reservation.money.subTotalPrice || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a>Guest service fee: <span data-ng-bind="(reservationBox.reservation.money.guestServiceFee || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Guest tax: <span data-ng-bind="(reservationBox.reservation.money.guestTaxes || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Guest total price: <span data-ng-bind="(reservationBox.reservation.money.guestTotalPrice || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a>Host service fee: <span data-ng-bind="(reservationBox.reservation.money.hostServiceFee || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Host tax: <span data-ng-bind="(reservationBox.reservation.money.hostTaxes || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Host payout: <span data-ng-bind="(reservationBox.reservation.money.hostPayout || 0) | currency:reservationBox.reservation.money.currency"></span></a>
                            </li>
                            <li>
                                <a>Guesty fee ({{reservationBox.reservation.money.ourCommission}}%): <span data-ng-bind="(reservationBox.reservation.money.ourFeeUsd || reservationBox.reservation.money.ourFee || 0) | currency:(reservationBox.reservation.money.ourFeeUsd ? 'USD' : reservationBox.reservation.money.currency)"></span></a>
                            </li>
                        </ul>
                    </div>
                    <div data-ng-if="isRequest && !reservationBox.reservation.approveState" class="btn-group" role="group">
                        <button class="btn btn-success" data-ng-click="reservationBox.approveReservationRequest()">Approve</button>
                    </div>
                    <div data-ng-if="isRequest && !reservationBox.reservation.declineState" class="btn-group" role="group">
                        <button class="btn btn-danger" data-ng-click="reservationBox.declineReservationRequest()">Decline</button>
                    </div>
                    <div data-ng-if="isInquiry && !reservationBox.reservation.preApproveState" class="btn-group">
                        <button class="btn btn-default" data-ng-click="reservationBox.preApprove()">Pre-approve</button>
                    </div>
                    <div data-ng-if="isInquiry && reservationBox.reservation.preApproveState" class="btn-group">
                        <button class="btn btn-default" data-ng-click="reservationBox.preApprove()">Cancel pre-approve</button>
                    </div>
                    <div data-ng-if="isInquiry && reservationBox.reservation.accountId && reservationBox.reservation.listingId" class="btn-group">
                        <button class="btn btn-default" data-ng-click="reservationBox.openSpecialOfferModal()">Special Offer</button>
                    </div>
                    <div data-ng-if="reservationBox.reservation._id" class="btn-group">
                        <button class="btn btn-primary" data-ng-click="reservationBox.openReservationModal()">Open</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

