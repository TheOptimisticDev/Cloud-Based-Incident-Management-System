'use strict';

// Dashboard controller
angular.module('dashboard').controller('DashboardEventsBoxController', ['$scope', '$stateParams', '$location', 'Dashboard', 'ListingsCalendar',
	function($scope, $stateParams, $location, Dashboard, ListingsCalendar) {

        $scope.now = new Date();

        // the parent view that holds the listing props can be one of those:
        var parentObj = $scope.ticket || $scope.reservation || $scope.conversation || $scope.notification;

		// Load the calendar related to the current ticket
		if (parentObj.listing) {
			ListingsCalendar.query({
				listingId: parentObj.listing._id,
				startDate: $scope.now,
				endDate: $scope.now
			}, function(listingsCalendars) {
				$scope.events = {};

				if (listingsCalendars.length > 0) {
					$scope.hasEvents = Object.keys(listingsCalendars[0].events).length > 0;
					$scope.events = listingsCalendars[0].events || {};
				}
			});
		} else {
			$scope.hasEvents = false;
			$scope.events = {};
		}
	}
]);
