'use strict';

angular.module('dashboard').controller('ShareController', [
    '$scope',
    '$uibModalInstance',
    'formData',
    'Dashboard',
    'Reservations',
    'CommonService',
    'notify',
    function($scope, $uibModalInstance, formData, Dashboard, Reservations, CommonService, notify) {
        $scope.shareContactList = [
            {
                name: 'Post-booking',
                email: 'postbookings@guesty.com'
            }
        ];

        $scope.email = $scope.shareContactList[0].email;

        $scope.save = function() {
            var share = new Dashboard({
                email: $scope.email,
                message: $scope.message,
                ticket: formData.ticket
            });
            share.$share({}, function() {
                $uibModalInstance.dismiss();
                notify({
                    message: 'Ticket was shared successfully',
                    classes: 'alert-success'
                });
                if (formData.ticket.reservationIds && formData.ticket.reservationIds.length) {
                    Reservations.log({ reservationId: formData.ticket.reservationIds[0] },{
                        event: 'Shared with ' + $scope.email
                    });
                }
            }, function() {
                notify({
                    message: 'Ticket share failed',
                    classes: 'alert-danger'
                });
            });
        };

    }
]);
