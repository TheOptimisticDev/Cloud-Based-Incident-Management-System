<section data-ng-controller="CreateConversationPostController" data-ng-init="init()" class="conversation-post">

    <div data-ng-if="conversationWith === 'User' && user.noteBeforeContacting" class="alert alert-warning">
        <strong>Notice:</strong>
        <span data-ng-bind="user.noteBeforeContacting"></span>
    </div>

    <div class="row form-group">
        <div class="col-sm-6">
            <!-- select method (platform/ email/ sms) -->
            <div class="btn-group" uib-dropdown>
                <button type="button" class="btn btn-default dropdown-toggle" data-ng-disabled="flags.sendingMessage || inQaMode" uib-dropdown-toggle>
                    <i class="dropdown-icon {{messageMethods[obj.module].classAttr}}">&nbsp;</i>
                    <span data-ng-bind="messageMethods[obj.module].displayName"></span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" uib-dropdown-menu>
                    <li data-ng-repeat="module in availableModules"><a class="btn" data-ng-click="changeMessageModule(module)"><i class="dropdown-icon {{messageMethods[module].classAttr}}">&nbsp;</i><span data-ng-bind="messageMethods[module].displayName"></span></a></li>
                </ul>
            </div>

            <!-- warnings, when selecting not preferred method -->
            <span data-ng-if="conversationWith === 'User' && user && user.preferredContactMethod && user.preferredContactMethod !== obj.module">
                <span class="text-danger">Notice:</span> User prefers <strong data-ng-bind="messageMethods[user.preferredContactMethod].displayName"></strong>
            </span>
            <span data-ng-if="conversationWith === 'Contact' && contact && contact.preferredContactMethod && contact.preferredContactMethod !== obj.module">
                <span class="text-danger">Notice:</span> Contact prefers <strong data-ng-bind="messageMethods[contact.preferredContactMethod].displayName"></strong>
            </span>
        </div>

        <div class="col-sm-6 text-right">
            <!-- send buttons -->
            <div class="btn-group" uib-dropdown data-ng-if="account._id">
                <a href="" role="button" class="dropdown-toggle btn-xs" uib-dropdown-toggle data-ng-if="!inQaMode">
                    Will send at: <span data-ng-bind="sendAt.chosenTime"></span>
                    <span data-ng-if="sendAt.chosenTime !== 'Now'" class="text-info">(Which is in {{sendAt.howFar}} hours)</span>
                </a>
                <ul class="dropdown-menu" role="menu" uib-dropdown-menu>
                    <li data-ng-repeat="time in sendAt.options"><a class="btn" data-ng-click="setSendAtTime(time)" data-ng-bind="time"></a></li>
                </ul>
            </div>
            <button class="btn btn-success" data-ng-if="!inQaMode" data-ng-click="save()" data-ng-disabled="disableSaveButton">Send</button>
        </div>
    </div>
    <div class="form-group text-center text-danger" data-ng-if="sendAt.chosenTime !== 'Now'">(When sending on a later time, message will be sent even if the conversation will be updated)</div>

    <div class="form-group notes">
        <!-- method module (MAIN PART) -->
        <div class="form-group">
            <div data-ng-if="obj.module" data-ng-include="'app/conversations/views/post/post-' + obj.module + '-module.html'"></div>
        </div>

        <!-- sending animation -->
        <i class="fa fa-spinner fa-spin" data-ng-show="flags.sendingMessage"></i>

        <!-- canned responses -->
        <div class="ittt form-group" data-ng-if="ittt.length">
            <span data-ng-repeat="item in ittt">
                <button type="button" class="btn btn-xs btn-default" data-ng-click="openIttt(item)">
                    if <strong data-ng-bind="item.ifThis"></strong>
                </button>
            </span>
        </div>

        <div class="form-group" data-ng-include="'app/conversations/views/post/canned-responses.client.view.html'"></div>

        <!-- reservation box -->
        <div data-ng-if="conversationWith === 'User' && reservationBox" class="reservation-box">
            <div class="text-center help-block">This reservation information box will be attached to your message:</div>
            <div class="html-container" data-ng-bind-html="reservationBox | trustedHtml"></div>
        </div>

    </div>
</section>
