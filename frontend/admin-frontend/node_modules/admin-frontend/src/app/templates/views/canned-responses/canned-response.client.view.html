<div data-ng-controller="CannedResponseController as cr" data-ng-init="init()">

    <div class="modal-header">
        <div class="pull-right">
            <label class="switch switch-md switch-primary force" data-ng-if="!cannedResponse.accountId && !cannedResponse.listingId && !cannedResponse.listingsIds">
                <input class="switch-input" type="checkbox" data-ng-model="cannedResponse.isAbstract">
                <span class="switch-label" data-off="Regular" data-on="Abstract"></span>
                <span class="switch-handle"></span>
            </label>
        </div>
        <h3>
            <span data-ng-bind="editType"></span> a saved reply
            <small data-ng-if="cannedResponse.listingsIds.length>1" class="text-warning">for multiple listings</small>
        </h3>
    </div>

    <div class="modal-body">
        <div class="alert alert-info" data-ng-show="cannedResponse.isAbstract">Abstract replies are only available to import</div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Reply</h3>
            </div>
            <div class="panel-body">
                <div class="form-group row">
                    <div data-ng-class="{'col-md-6': cannedResponse.isAbstract, 'col-md-12':!cannedResponse.isAbstract}">
                        <label>When a {{cannedResponse.type}} asks about:</label>
                        <input type="text" class="form-control" data-ng-model="cannedResponse.question">
                    </div>
                    <div data-ng-if="cannedResponse.isAbstract" class="col-md-6">
                        <label>Title for import mode:</label>
                        <input type="text" class="form-control" data-ng-model="cannedResponse.titleForImportMode">
                    </div>
                </div>

                <div class="form-group">
                    <label>The answer should be:</label>
                    <textarea data-g-autoresize spellcheck="true" data-ng-model="cannedResponse.answer" class="form-control"></textarea>
                </div>
                <div data-ng-include="'app/templates/views/template-placeholders.client.view.html'"></div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Relevance</h3>
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label>For the <span data-ng-if="cr.selectedListings.length" data-ng-bind="cr.selectedListings.length"></span> listings:</label>
                    <ui-select multiple ng-model="cr.selectedListings" class="with-pics">
                        <ui-select-match placeholder="All listings">
                            <span data-ng-bind="$item.nickname || $item.title" title="{{$item.address.full}}"></span>
                        </ui-select-match>
                        <ui-select-choices repeat="item in listings"
                                           refresh="loadListings($select.search)"
                                           refresh-delay="250">
                            <img class="pull-right" data-ng-if="item.picture.thumbnail" data-ng-src="{{item.picture.thumbnail}}">
                            <div class="truncate">
                                <span data-ng-if="item.nickname" class="label label-info" data-ng-bind="item.nickname"></span>
                                <strong data-ng-bind="item.title"></strong>
                            </div>
                            <div class="truncate" data-ng-bind="item.address.full"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>

                <div class="form-group">
                    <label>For conversations with: </label>
                    <select data-ng-model="cannedResponse.type">
                        <option value="user">User</option>
                        <option value="guest">Guest</option>
                        <option value="contact">Contact</option>
                    </select>
                </div>


                <div class="form-group">
                    <label>Folder:</label> <small class="text-muted">(Leave empty to show on its own)</small>
                    <input type="text" class="form-control" data-ng-model="cannedResponse.folder">
                </div>

                <div class="form-group" data-ng-if="cannedResponse.$resolved || cannedResponse.language">
                    <label>Language:</label>
                    <select data-ng-model="cannedResponse.language" data-ng-options="language as language for language in optionalLanguages"></select>
                    <small class="text-muted">(This template will only be shown for conversations in the selected language)</small>
                </div>
                <div class="form-group">
                    <label><input class="form-input" data-ng-checked="cannedResponse.applyWhenNoBooking" data-ng-model="cannedResponse.applyWhenNoBooking" type="checkbox">
                        <span>Show when there’s no confirmed reservation</span></label>
                    <label><input class="form-input" data-ng-checked="cannedResponse.applyWhenHasBooking" data-ng-model="cannedResponse.applyWhenHasBooking" type="checkbox">
                        <span>Show when there’s a confirmed reservation</span></label>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button class="btn btn-danger pull-left" data-ng-if="cannedResponse._id" data-ng-click="remove(cannedResponse)" title="delete canned response">Delete</button>
        <button class="btn btn-success" data-ng-click="save(cannedResponse)" title="save canned response">Save</button>
        <button class="btn btn-default" data-ng-click="$dismiss()">Cancel</button>
    </div>
</div>
