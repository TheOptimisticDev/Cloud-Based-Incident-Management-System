<section data-ng-controller="ReservationsSearchController" data-ng-init="init()" class="reservations-search">
	<div class="page-header">
		<h1>Search Reservations</h1>
	</div>
	<form data-ng-submit="search()">
		<div class="row form-wrapper">
			<div class="col-sm-2">
				<label>Confirmed At:</label>
				<g-datepicker ng-model="query.confirmedAt.startDate"></g-datepicker>
				<label>Until:</label>
				<g-datepicker ng-model="query.confirmedAt.endDate"></g-datepicker>
			</div>
			<div class="col-sm-2">
				<label>Canceled At:</label>
				<g-datepicker ng-model="query.canceledAt.startDate"></g-datepicker>
				<label>Until:</label>
				<g-datepicker ng-model="query.canceledAt.endDate"></g-datepicker>
			</div>
			<div class="col-sm-2">
				<label>Check-In:</label>
				<g-datepicker ng-model="query.checkIn.startDate"></g-datepicker>
				<label>Until:</label>
				<g-datepicker ng-model="query.checkIn.endDate"></g-datepicker>
			</div>
			<div class="col-sm-2">
				<label>Check-Out:</label>
				<g-datepicker ng-model="query.checkOut.startDate"></g-datepicker>
				<label>Until:</label>
				<g-datepicker ng-model="query.checkOut.endDate"></g-datepicker>
			</div>
			<div class="col-sm-4">
				<label>People:</label>
				<!-- Account selection -->
				<p class="input-group">
					<span class="input-group-addon">Account</span>
					<input type="text" class="form-control" data-ng-model="query.account" uib-typeahead="account as account.name for account in findAccounts($viewValue)" typeahead-on-select="specificAccountSelected($item, $model, $label)">
				</p>
				<!-- Listing selection -->
				<p class="input-group" data-ng-if="query.accountId">
                    <span class="input-group-addon">Listing</span>
                    <input type="text" class="form-control" data-ng-model="query.listing" uib-typeahead="listing as (listing.nickname || listing.title) for listing in findListings($viewValue)" typeahead-on-select="specificListingSelected($item, $model, $label)">
				</p>
				<!-- Guest selection -->
				<p class="input-group" data-ng-if="query.accountId">
					<span class="input-group-addon">Guest</span>
                    <input type="text" class="form-control" data-ng-model="query.guest" uib-typeahead="guest as guest.fullName for guest in findGuests($viewValue)" typeahead-on-select="specificGuestSelected($item, $model, $label)">
				</p>
			</div>
		</div>
		<div class="row form-wrapper">
			<div class="col-md-3">
				<div class="form-group">
					<button class="btn btn-block btn-default" type="submit">
						<i class="glyphicon glyphicon-search"></i> Search Reservations
					</button>
				</div>
			</div>
			<div class="col-md-9 text-right">
				<uib-pagination total-items="totalCount" ng-model="currentPage" max-size="5" items-per-page="50" ng-change="find()"></uib-pagination>
			</div>
		</div>
	</form>
	<div data-ng-hide="reservations" class="text-center loading-box">
		<img src="/app/core/img/loaders/loader.gif" alt="Loading">
	</div>
	<table data-ng-show="reservations" class="table table-hover reservations-list">
		<thead>
			<tr>
				<th>Confirmation</th>
				<th>Account</th>
				<th>Guest</th>
				<th>Email</th>
				<th>Phone</th>
				<th>Check-in</th>
				<th>Check-out</th>
				<th colspan="3">Status</th>
			</tr>
		</thead>
		<tbody data-ng-repeat="reservation in reservations" class="reservation">
			<tr data-ng-click="toggleReservation(reservation)">
				<td>
					<a data-ui-sref="reservations.reservation({ reservationId: reservation._id })" data-ng-bind="reservation.confirmationCode"></a>
					<span data-ng-if="reservation.status==='canceled'" class="label label-sm label-danger"><i class="fa fa-close"></i></span>
				</td>
				<td>
					<a data-ui-sref="account.settings({ accountId: reservation.accountId })" data-ng-bind="reservation.account.name"></a>
				</td>
				<td data-ng-bind="reservation.guest.fullName"></td>
				<td data-ng-bind="reservation.guest.email"></td>
				<td data-ng-bind="reservation.guest.phone"></td>
				<td data-ng-bind="reservation.checkIn | dateTimezone: reservation.listing.timezone"></td>
				<td data-ng-bind="reservation.checkOut | dateTimezone: reservation.listing.timezone"></td>
				<td class="text-center" data-ng-class="reservation.postBooking.colorHost || defaultStatusClass"><i class="fa fa-user"></i>
				</td>
				<td class="text-center" data-ng-class="reservation.postBooking.colorGuest || defaultStatusClass"><i class="fa fa-suitcase"></i>
				</td>
				<td class="text-center" data-ng-class="reservation.postBooking.colorCleaning || defaultStatusClass"><i class="fa fa-magic"></i>
				</td>
			</tr>
			<tr data-ng-if="reservation.isOpen" class="active no-hover">
				<td colspan="10">
					<div data-ng-include="'app/reservations/views/reservation/reservation.client.view.html'"></div>
				</td>
			</tr>
		</tbody>
	</table>
</section>
