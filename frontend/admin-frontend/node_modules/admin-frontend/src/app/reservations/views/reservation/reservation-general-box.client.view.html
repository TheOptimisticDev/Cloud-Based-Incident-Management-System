<div class="panel panel-default" data-ng-controller="ReservationGeneralBoxController">
    <div class="panel-body">
        <div data-ng-if="reservation.ignoredAt" class="alert alert-danger">
            <strong>This reservation was set to be ignore!</strong>
            <span data-ng-if="reservation.ignoredReason" data-ng-bind="'(' + reservation.ignoredReason + ')'"></span>
        </div>
        <div class="pull-right text-right">
            <button class="btn btn-default" data-ng-click="openAlterReservationModal()" title="Alter Reservation" data-ng-if="alterIsAllowed">Alter</button>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <strong data-ng-bind="reservation.confirmationCode"></strong>
                    <div>Created at {{reservation.createdAt | date: 'short'}}</div>
                    <div data-ng-if="reservation.confirmedAt">Confirmed at {{reservation.confirmedAt | date:'short'}}</div>
                    <div data-ng-if="reservation.instantBook"><span class="label label-warning">Instant Book</span></div>
                    <div data-ng-if="reservation.importedAt">Imported at {{reservation.importedAt | date:'short'}}</div>
                    <div data-ng-if="reservation.canceledBy">Canceled at {{reservation.canceledAt | date:'short'}} by {{reservation.canceledBy}}</div>
                    <hr>
                </div>
                <div class="form-group">
                    <div>
                        <label>Account:</label>
                        <a data-ui-sref="account.settings({accountId: reservation.accountId})" data-ng-bind="reservation.account.name"></a>
                    </div>

                    <div data-ng-if="reservation.integration._id">
                        <label>Integration:</label>
                        <span data-ng-bind="reservation.integration.object.nickname ? reservation.integration.object.nickname : 'Untitled'"></span>
                        ({{reservation.integration.platform}})
                    </div>
                    <div>
                        <label>Source:</label>
                        <span ng-bind="reservation.source"></span>
                    </div>

                    <div data-ng-if="reservation.listing">
                        <div class="child-hover">
                            <button role="button" class="btn btn-default btn-sm pull-right show-on-parent-hover" data-ng-click="openListingModal()"><i class="fa fa-external-link"></i></button>
                            <label>Listing:</label>
                            <a data-ui-sref="listing.settings({listingId: reservation.listingId})">
                                {{reservation.listing.title}}
                                <span class="label label-info" data-ng-bind="reservation.listing.nickname"></span>
                            </a>
                        </div>
                        <div data-ng-bind="reservation.listing.address.full"></div>
                    </div>
                </div>
                <hr>
                <div>
                    <div data-ng-if="reservation.guestsCount"><i class="fa fa-users"></i> <strong data-ng-bind="reservation.guestsCount"></strong> people</div>
                    <div data-ng-if="reservation.isReturningGuest" class="label label-info">Returning guest</div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="top-buffer child-hover">
                    <button type="button" data-ng-click="setArrivalTime()" class="btn btn-default btn-xs pull-right show-on-parent-hover">Set <strong>arrival</strong> time</button>
                    <i class="fa fa-plane fa-rotate-90"></i> {{reservation.checkIn | dateTimezone: reservation.listing.timezone}}
                    <div data-ng-if="reservation.plannedArrival"><small>Planned Arrival:</small> {{reservation.plannedArrival}}</div>
                </div>
                <div class="top-buffer child-hover">
                    <button type="button" data-ng-click="setDepartureTime()" class="btn btn-default btn-xs pull-right show-on-parent-hover">Set <strong>departure</strong> time</button>
                    <i class="fa fa-plane"></i> {{reservation.checkOut | dateTimezone: reservation.listing.timezone}}
                    <div data-ng-if="reservation.plannedDeparture"><small>Planned Departure:</small> {{reservation.plannedDeparture}}</div>
                </div>
                <hr>
                <div class="btn-group dropdown pull-right" uib-dropdown>
                    <button class="btn btn-default dropdown-toggle" type="button" id="reservationMoneyMenu" uib-dropdown-toggle>
                        <i class="fa fa-usd"></i>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="reservationMoneyMenu" uib-dropdown-menu>
                        <li>
                            <a>Accommodation fare: <span data-ng-bind="(reservation.money.fareAccommodation || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Nightly rate: <span data-ng-bind="((reservation.money.fareAccommodation || 0)/reservation.nightsCount) | currency:reservationBox.reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Cleaning fare: <span data-ng-bind="(reservation.money.fareCleaning || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Sub total: <span data-ng-bind="(reservation.money.subTotalPrice || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a>Guest service fee: <span data-ng-bind="(reservation.money.guestServiceFee || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Guest tax: <span data-ng-bind="(reservation.money.guestTaxes || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Guest total price: <span data-ng-bind="(reservation.money.guestTotalPrice || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a>Host service fee: <span data-ng-bind="(reservation.money.hostServiceFee || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Host tax: <span data-ng-bind="(reservation.money.hostTaxes || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Host payout: <span data-ng-bind="(reservation.money.hostPayout || 0) | currency:reservation.money.currency"></span></a>
                        </li>
                        <li>
                            <a>Guesty fee ({{reservation.guestyFeeDetails.commission}}%): <span data-ng-bind="reservation.guestyFeeDetails.fee | currency:reservation.money.currency"></span></a>
                        </li>
                    </ul>
                </div>
                <div><strong>Host Payout:</strong> {{reservation.money.hostPayout | currency: reservation.money.currency}}</div>
                <div><strong>Guesty fee</strong> ({{reservation.guestyFeeDetails.commission}}%): <span data-ng-bind="reservation.guestyFeeDetails.fee | currency:reservation.money.currency"></span></div>
                <hr>
                <div class="top-buffer"><strong>Cancellation Policy:</strong> {{reservation.cancellationPolicy || 'Unknown'}}</div>
            </div>
        </div>
    </div>
</div>
