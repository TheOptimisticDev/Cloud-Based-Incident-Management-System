<section data-ng-controller="ReservationCustomFieldsController as rcf" data-ng-init="rcf.init(reservation)">
    <form name="frmCustomFields" role="form" data-ng-if="rcf.customFields.length" data-ng-submit="rcf.submitCustomFields(updateReservation, frmCustomFields)">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Extra Information</h3>
            </div>
            <div class="panel-body">
                <div class="form-group" data-ng-repeat="field in rcf.customFields">
                    <label data-ng-bind="field.key"></label>
                    <input data-ng-if="field.type==='text'" class="form-control" data-ng-model="field.value" title="{{field.key}}" type="text">
                    <input data-ng-if="field.type==='number'" class="form-control" data-ng-model="field.value" title="{{field.key}}" type="number" string-to-number>
                    <textarea data-ng-if="field.type==='longtext'" class="form-control" rows="4" data-ng-model="field.value" title="{{field.key}}"></textarea>
                    <span data-ng-if="field.type==='boolean'">
                        <input class="js-switch" ui-switch="{size: 'small'}" data-ng-model="field.value" title="{{field.key}}" type="checkbox">
                        <span data-ng-bind="field.value?'Yes':'No'"></span>
                    </span>
                    <div data-ng-if="field.type==='date'">
                        <span data-ng-if="field.value" data-ng-bind="field.value|date:'shortDate'"></span>
                        <date-picker data-ng-model="field.value" empty-text="Select a date" options="{showWeeks:false}" btn-class="btn-sm"></date-picker>
                    </div>
                    <div data-ng-if="field.type==='time'">
                        <span data-ng-if="field.value" data-ng-bind="field.value|dateFromString|date:'shortTime'"></span>
                        <g-time-picker data-ng-model="field.value" empty-text="Select a time" minute-step="15" default-time="'11:00'" format="HH:mm" btn-class="btn-sm"></g-time-picker>
                    </div>
                    <div data-ng-if="field.type==='user' || field.type==='contact'">
                        <span data-ng-if="field.value" data-ng-bind="field.displayValue"></span>
                        <div class="btn-group" uib-dropdown>
                            <button type="button" class="btn btn-default dropdown-toggle btn-sm" data-ng-class="{empty:!field.value}" uib-dropdown-toggle>
                                <span data-ng-if="!field.value">Select</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li data-ng-show="field.value"><a href="" data-ng-click="field.value=null; field.displayValue=null; frmCustomFields.$setDirty();">Clear</a></li>
                                <li data-ng-show="field.value" class="divider"></li>
                                <li data-ng-repeat="user in rcf[field.type+'s'].results" data-ng-hide="user._id===field.value">
                                    <a href="" data-ng-click="field.value=user._id; field.displayValue=user.fullName; frmCustomFields.$setDirty();" data-ng-bind="user.fullName"></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div data-ng-if="field.type==='enum'">
                        <span data-ng-if="field.value" data-ng-bind="field.value"></span>
                        <div class="btn-group" uib-dropdown>
                            <button type="button" class="btn btn-default dropdown-toggle btn-sm" data-ng-class="{empty:!field.value}" uib-dropdown-toggle>
                                <span data-ng-if="!field.value">Select</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li data-ng-show="field.value"><a href="" data-ng-click="field.value=null; field.displayValue=null; frmCustomFields.$setDirty();">Clear</a></li>
                                <li data-ng-show="field.value" class="divider"></li>
                                <li data-ng-repeat="option in field.options" data-ng-hide="option===field.value">
                                    <a href="" data-ng-click="field.value=option; frmCustomFields.$setDirty();" data-ng-bind="option"></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-footer text-right" data-ng-show="frmCustomFields.$dirty">
                <button type="submit" data-ng-disabled="frmCustomFields.$submitted" class="btn btn-primary">
                    Save
                    <i data-ng-if="frmCustomFields.$submitted" class="fa fa-spinner fa-spin"></i>
                </button>
            </div>
        </div>
    </form>
</section>