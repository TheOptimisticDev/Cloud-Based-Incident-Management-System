<div class="panel panel-default" data-ng-controller="ReservationHooksBoxController">
    <div class="panel-heading">
        <span>Hooks</span>
        <div class="pull-right"><button type="button" class="btn btn-primary btn-xs" data-ng-click="openAddReservationHookModal()">Add one time hook for this reservation</button></div>
    </div>
    <table class="table" data-ng-if="hooks.length">
        <tbody data-ng-repeat="hook in hooks">
            <tr data-ng-class="{'bg-danger': hook.status==='error'}">
                <td>
                    <span data-ng-bind="hook.when|hookWhen"></span>
                    <span data-ng-bind="hook.event"></span>
                </td>
                <td data-ng-bind="hook.action"></td>
                <td>{{hook.template.name}} {{(hook.message || '').substr(0,500)}}</td>
                <td data-ng-if="!hook.isEditMode" data-ng-bind="(hook.completedAt || hook.scheduledTime) |date: 'short'"></td>
                <td data-ng-if="hook.isEditMode">
                    <g-datetimepicker data-ng-model="hook.editedScheduledTime"></g-datetimepicker>
                </td>
                <td style="width: 100px;">
                    <span data-ng-if="hook.completedAt" class="label label-success"><i class="fa fa-check"></i></span>
                    <span data-ng-if="hook.status=='canceled'" class="text-danger">Canceled</span>
                    <div data-ng-if="!(hook.completedAt || hook.isEditMode) && hook.status!=='canceled'" class="btn-group">
                        <button data-ng-click="toggleEditHookMode(hook)" class="btn btn-sm btn-default"><i class="fa fa-pencil fa-fw"></i></button>
                        <button data-ng-click="deleteHook(hook)" class="btn btn-sm btn-danger" data-ng-disabled="hook.isDeleteLoading">
                            <i data-ng-if="!hook.isDeleteLoading" class="fa fa-trash-o fa-lg"></i>
                            <i data-ng-if="hook.isDeleteLoading" class="fa fa-spinner fa-spin"></i>
                        </button>
                    </div>
                    <div data-ng-if="hook.isEditMode" class="btn-group">
                        <button data-ng-click="updateHook(hook)" class="btn btn-sm btn-success" data-ng-disabled="hook.isUpdateLoading">
                            <i data-ng-if="!hook.isUpdateLoading" class="fa fa-floppy-o"></i>
                            <i data-ng-if="hook.isUpdateLoading" class="fa fa-spinner fa-spin"></i>
                        </button>
                        <button data-ng-click="toggleEditHookMode(hook)" class="btn btn-sm btn-danger"><i class="fa fa-times"></i></button>
                    </div>
                </td>
            </tr>
            <tr data-ng-if="hook.error">
                <td colspan="5">
                    <span class="label label-danger">Error:</span>
                    <span data-ng-bind="hook.error"></span>
                </td>
            </tr>
        </tbody>
    </table>
    <div class="panel-body" data-ng-if="!hooks.length">
        None
    </div>
</div>
