'use strict';

//Reservations modals service
angular.module('reservations').factory('ReservationsModalService', ['$uibModal',
    function($uibModal) {

        /**
         * fill the formData with reservation object and/or reservationId
         * return true if did it, or false if there's a problem
         * @param formData {*}
         * @param reservationOrReservationId {*}
         * @returns {boolean}
         */
        function setReservationOrReservationId(formData, reservationOrReservationId) {
            if(typeof reservationOrReservationId === 'string') {
                formData.reservationId = reservationOrReservationId;
            } else if(reservationOrReservationId) {
                formData.reservation = reservationOrReservationId;
                formData.reservationId = reservationOrReservationId._id;
            }
            return !!formData.reservationId;
        }

        return {
            /**
             * open a modal for alter reservation for reservation
             * @param reservationOrReservationId {*} - can be the reservationId or the reservation object itself
             * @param [preDefinedFormData] {{price, listingId, startDate, endDate, guests}} - predefined data to fill be filled on init
             * @returns {promise}
             */
            openAlterReservationModal: function (reservationOrReservationId, preDefinedFormData) {
                var formData = _.extend({}, preDefinedFormData);
                if(setReservationOrReservationId(formData, reservationOrReservationId))
                    return $uibModal.open({
                        templateUrl: 'app/reservations/views/modals/alter-reservation-modal.client.view.html',
                        controller: 'AlterReservationModalController',
                        resolve: {
                            formData: function() {
                                return formData;
                            }
                        }
                    }).result;
            },
            openCleaningAppointmentModal: function(reservationOrReservationId, appointment, preDefinedFormData) {
                var formData = {
                    appointment: appointment,
                    options: preDefinedFormData
                };
                if(setReservationOrReservationId(formData, reservationOrReservationId))
                    return $uibModal.open({
                        templateUrl: 'app/reservations/views/modals/cleaning-appointment-modal.client.view.html',
                        controller: 'CleaningAppointmentModalController',
                        resolve: {
                            formData: function() {
                                return formData;
                            }
                        }
                    }).result;
            },
            openCreateReservationHookModal: function(reservation) {
                return $uibModal.open({
                    templateUrl: 'app/reservations/views/modals/create-booking-hook-modal.client.view.html',
                    controller: 'CreateReservationHookModalController as ctrl',
                    size: 'md',
                    resolve: {
                        reservation: function () {
                            return reservation;
                        }
                    }
                }).result;
            }
        };
    }
]);
