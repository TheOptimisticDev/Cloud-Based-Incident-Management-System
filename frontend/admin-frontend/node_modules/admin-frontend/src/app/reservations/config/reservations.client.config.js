'use strict';

// Configuring the Reservations module
angular.module('reservations').run(['Menus', '$state',
	function(Menus, $state) {
		// Set moment parameters
		var today = moment().format('YYYY-MM-DD');
		var twoDaysFromNow = moment().add(2, 'days').format('YYYY-MM-DD');
		var threeDaysAgo = moment().subtract(3, 'days').format('YYYY-MM-DD');

		// Helper function for activating a menu item
		var isActive = function(item) {
			return (($state.params.checkIn || null) === (item.params.checkIn || null) &&
					($state.params.checkOut || null) === (item.params.checkOut || null) &&
					($state.params.confirmedAt || null) === (item.params.confirmedAt || null) &&
					($state.params.canceledAt || null) === (item.params.canceledAt || null));
		};

		// Add the Reservations dropdown item
		Menus.addMenuItem('topbar', {
			title: 'Reservations',
			state: 'reservations',
			type: 'dropdown',
			position: 2
		});

		// Add submenu item
		Menus.addSubMenuItem('topbar', 'reservations', {
			title: 'Search Reservations',
			state: 'reservations.search',
			params: {
				checkIn: today + ',' + twoDaysFromNow
			}
		});

		// Add submenu item
		Menus.addSubMenuItem('topbar', 'reservations', {
			title: 'Pending Requests',
			state: 'pending-requests'
		});

		Menus.addMenu('reservations', {
			// stateOptions: {
			// 	inherit: false
			// },
			items: [{
				title: 'Search Reservations',
				state: 'reservations.search',
				active: isActive,
				params: {
					checkIn: '',
					checkOut: '',
					confirmedAt: '',
					canceledAt: ''
				}
			}, {
				title: 'Upcoming Reservations',
				active: isActive,
				state: 'reservations.search',
				params: {
					checkIn: today + ',' + twoDaysFromNow,
					checkOut: '',
					confirmedAt: '',
					canceledAt: ''
				}
			}, {
				title: 'Ongoing Reservations',
				active: isActive,
				state: 'reservations.search',
				params: {
					checkIn: ',' + today,
					checkOut: today,
					confirmedAt: '',
					canceledAt: ''
				}
			}, {
				title: 'Future Reservations',
				active: isActive,
				state: 'reservations.search',
				params: {
					checkIn: today,
					checkOut: '',
					confirmedAt: '',
					canceledAt: ''
				}
			}, {
				title: 'Past Reservations',
				active: isActive,
				state: 'reservations.search',
				params: {
					checkOut: ',' + today,
					checkIn: '',
					confirmedAt: '',
					canceledAt: ''
				}
			}, {
				title: 'Confirmed in the last 3 days',
				active: isActive,
				state: 'reservations.search',
				params: {
					confirmedAt: threeDaysAgo,
					checkIn: '',
					checkOut: '',
					canceledAt: ''
				}
			}, {
				title: 'Canceled in the last 3 days',
				active: isActive,
				state: 'reservations.search',
				params: {
					canceledAt: threeDaysAgo,
					checkIn: '',
					checkOut: '',
					confirmedAt: ''
				}
			}, {
				title: 'Last minute reservations',
				active: isActive,
				state: 'reservations.search',
				params: {
					checkIn: today + ',' + twoDaysFromNow,
					confirmedAt: threeDaysAgo,
					checkOut: '',
					canceledAt: ''
				}
			}]
		});
	}
]);
