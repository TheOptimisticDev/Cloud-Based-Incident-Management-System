'use strict';

// Reservations controller
angular.module('reservations').controller('ReservationGeneralBoxController', [
    '$scope',
    'notify',
    'ReservationsModalService',
    'ListingsModalsService',
    function($scope, notify, ReservationsModalService, ListingsModalsService) {

        // should have a reservation at the scope
        if(!$scope.reservation) {
            notify({message: 'Reservation was not found', classes: 'alert-danger'});
            return;
        }


        // enable alter only for active / pre-active reservations
        $scope.alterIsAllowed = moment($scope.reservation.checkOut).isAfter(moment().startOf('day'));


        /**
         * open the alter reservation modal for current reservation
         */
        $scope.openAlterReservationModal = function() {
            ReservationsModalService.openAlterReservationModal($scope.reservation);
        };

        /**
         * open the listing modal
         */
        $scope.openListingModal = function() {
            ListingsModalsService.openListingModal($scope.reservation.listingId);
        };

        /**
         * set arrival time of guest
         */
        $scope.setArrivalTime = function() {
            setTime('plannedArrival');
        };

        /**
         * set Departure Time of guest
         */
        $scope.setDepartureTime = function(){
            setTime('plannedDeparture');
        };

        /**
         * ask the user for time and save it on the given field.
         * @param field
         */
        function setTime(field){
            var time = prompt('Enter time in format: 00:00 (24 hours) for instance: 1:30pm would be 13:30. Always use local timezone.');
            if (!time) return;

            $scope.reservation[field] = time;
            $scope.updateReservation(null, field);
        }

    }
]);
