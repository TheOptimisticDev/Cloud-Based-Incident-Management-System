<section data-ng-controller="DashboardTicketsController" data-ng-init="init()" class="dashboard-tickets">
    <div class="page-header">
        <h1 data-ng-dblclick="showPriority=true">Dashboard Tickets</h1>
    </div>
    <div class="page-body">

        <div class="form-group">
            <h5>Currently active receptionists:</h5>
            <ul>
                <li data-ng-repeat="receptionist in activeReceptionists | orderBy:'-tickets'">
                    <i class="fa fa-circle text-small text-success" data-ng-if="receptionist.online"></i>
                    {{receptionist.username}}:
                    <span class="badge badge-success">{{receptionist.tickets}}</span>
                    <span class="text-muted">(~{{receptionist.ticketsAvg}}/hour)</span>
                    <i class="text-muted" data-ng-if="receptionist.inPause"></i>
                </li>
            </ul>
        </div>
        <hr>

        <div class="row">
            <div class="col-md-6">
                <span><button type="button" class="btn btn-default" data-ng-click="find()"><i class="fa fa-refresh"></i></button></span>
                <label class="switch switch-primary switch-md force">
                    <input class="switch-input" data-ng-model="isGoldfish" type="checkbox" data-ng-change="find()">
                    <span class="switch-label" data-off="All" data-on="Goldfish"></span>
                    <span class="switch-handle"></span>
                </label>
                <span data-ng-show="totalCount" class="tickets-counter"><span data-ng-bind="totalCount"></span> Open Tickets. (+<span data-ng-bind="reviewsCount"></span> Reviews)</span>
            </div>
            <div class="col-md-6 text-right">
                <uib-pagination ng-show="totalCount" total-items="totalCount" ng-model="currentPage" boundary-links="true" max-size="5" items-per-page="query.limit" ng-change="find()"></uib-pagination>
            </div>
        </div>
        <div data-ng-hide="tickets" class="text-center loading-box">
            <img src="app/core/img/loaders/loader.gif" alt="Loading">
        </div>
        <table data-ng-show="tickets" class="table table-hover">
            <thead>
            <tr>
                <th>Account</th>
                <th style="width: 135px;">
                    <i class="fa fa-user" title="Account category"></i>
                </th>
                <th>Guest</th>
                <th>Tasks</th>
                <th>Wait time</th>
                <th>Assigned to</th>
                <th data-ng-if="showPriority">Priority</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody data-ng-repeat="ticket in tickets" class="dashboard-ticket">
            <tr>
                <td data-ng-bind="ticket.accountName"></td>
                <td>
                    <fish-icon data-ng-model="ticket.accountCategorization"></fish-icon>
                </td>
                <td data-ng-bind="ticket.guestName"></td>
                <td>
                    <span class="label label-sm label-info" data-ng-repeat="task in ticket.actionsRequired" data-ng-bind="task.title ? task.title : task.type"></span>
                </td>
                <td data-ng-bind="ticket.createdAt | elapsedTime:'hh:mm'"></td>
                <td>
                    <span data-ng-bind="ticket.assignedTo || '---'"></span>
                    <span class="label label-sm label-warning" data-ng-if="ticket.isInProgress"><i class="fa fa-play"></i></span>
                    <div data-ng-if="ticket.assignedAt">(<span am-time-ago="ticket.assignedAt"></span>)</div>
                </td>
                <td data-ng-if="showPriority" data-ng-bind="ticket.priority"></td>
                <td>
                    <div class="btn-group" uib-dropdown data-ng-if="canAssignTickets">
                        <button class="btn btn-default dropdown-toggle" type="button" data-ng-click="updateEmployeesInInbox()" uib-dropdown-toggle>
                            Assign <b class="caret"></b>
                        </button>
                        <ul data-ng-if="usersInInbox.$resolved" class="dropdown-menu dropdown-menu-right" role="menu" uib-dropdown-menu>
                            <li data-ng-repeat="user in usersInInbox">
                                <a class="btn" data-ng-click="assignTicket(ticket, user.username)" data-ng-bind="user.presentableName"></a>
                            </li>
                        </ul>
                        <ul data-ng-if="!usersInInbox.$resolved" class="dropdown-menu dropdown-menu-right" role="menu" uib-dropdown-menu>
                            <li class="text-center"><i class="fa fa-spinner fa-pulse fa-3x"></i></li>
                        </ul>
                    </div>
                    <a class="btn btn-default" data-ui-sref="inbox.ticket({ticketId: ticket._id})" target="_blank">Open</a>

                    <span class="btn-group">
                        <button type="button" class="btn btn-default" data-ng-click="setTicketPriority(ticket, 1)"><i class="fa fa-arrow-up"></i></button>
                        <button type="button" class="btn btn-default" data-ng-click="setTicketPriority(ticket, 9999)"><i class="fa fa-arrow-down"></i></button>
                    </span>

                    <button type="button" class="btn btn-success" data-ng-click="completeTicket(ticket)"><i class="glyphicon glyphicon-ok"></i></button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</section>
