/* global _, moment */
'use strict';

// Shift List controller
angular.module('admin').controller('StaticMetricsController', [
    '$scope',
    'StaticMetrics',
    'notify',
    'CommonService',
    function($scope, StaticMetrics, notify, CommonService) {

        $scope.metricTypes = [
            {
                metric: 'service costs',
                period: 'month'
            },
            {
                metric: 'burn',
                period: 'month'
            },
            {
                metric: 'total expanses',
                period: 'month'
            },
            {
                metric: 'monthly goal',
                period: 'month'
            }
        ];

        $scope.getDateFormatByPeriod = function(period){
            if (period === 'month') return 'MMMM yyyy';
        };

        $scope.find = function(){
            $scope.metrics = StaticMetrics.query();
        };

        $scope.editValue = function(metric){
            var newValue = prompt('Please enter a new value');
            if (!newValue) return;

            metric.value = newValue;
            metric.$update(function(){
                $scope.find();
            }, function(err) {
                notify({
                    message: err.message,
                    classes: 'alert-danger'
                });
            });
        };

        $scope.deleteMetric = function(metric){
            CommonService.confirm().then(function() {
                metric.$remove(function() {
                    notify({
                        message: 'Metric removed successfully',
                        classes: 'alert-success'
                    });
                    $scope.find();
                }, function() {
                    notify({
                        message: 'Failed to remove metric',
                        classes: 'alert-danger'
                    });
                });
            });
        };

        $scope.saveNew = function(add){
            add.period = add.metric.period;
            add.metric = add.metric.metric;

            var metric = new StaticMetrics(add);
            metric.$save(function() {
                notify({
                    message: 'Metric added successfully',
                    classes: 'alert-success'
                });
                $scope.addMode = false;
                $scope.add = {};
                $scope.find();
            }, function() {
                notify({
                    message: 'Failed to add metric',
                    classes: 'alert-danger'
                });
            });
        };

    }
]);
