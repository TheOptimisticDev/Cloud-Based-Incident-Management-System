'use strict';

// Admins main controller
angular.module('team').controller('TeamUpdatesController', ['$scope', 'Authentication', '$sce', 'TeamUpdatePost', '$stateParams', '$window', 'gNotify',
    function($scope, Authentication, $sce, TeamUpdatePost, $stateParams, $window, gNotify) {

        $scope.locationHost = $window.location.host;

        $scope.postId = $stateParams.postId;
        $scope.mode = $stateParams.mode || 'unseen';

        $scope.loadPosts = function(){
            $scope.posts = TeamUpdatePost.query({postId: $stateParams.postId, mode: $scope.mode});
        };

        $scope.trustAsHtml = $sce.trustAsHtml;

        $scope.addToList = function(post, list){
            TeamUpdatePost.addToList({_id: post._id}, {list: list}, function(resp){
                //update view
                post.watchLater = resp.watchLater;
                post.confirmedWatching = resp.confirmedWatching;
            }, function(){
                gNotify.alert('Sorry. We have an error.');
            });
        };

        $scope.isOnList = function(post, list){
            if (!post || !list) return false;
            return !_.isUndefined(_.find(post[list], {'name': Authentication.getEmployee().username}));
        };

    }
]);
