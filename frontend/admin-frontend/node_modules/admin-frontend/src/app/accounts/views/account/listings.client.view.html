<div data-ng-controller="AccountListingsController as listingsCtrl" data-ng-init="listingsCtrl.init()">
    <div class="page-header">
        <div class="pull-right">
            <div class="btn-group" uib-dropdown>
                <button class="btn btn-default btn-sm dropdown-toggle" type="button" uib-dropdown-toggle>
                    <i class="fa fa-filter"></i>
                    Filter integration:
                    <strong data-ng-bind="listingsCtrl.filterByIntegrationId ? (integrationsById[listingsCtrl.filterByIntegrationId].nickname || 'Untitled') : 'All'"></strong>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" uib-dropdown-menu>
                    <li><a href="#" data-ng-click="listingsCtrl.filterByIntegration(null)">All</a></li>
                    <li><a href="#" data-ng-repeat="integration in integrationsById" data-ng-bind="integration.nickname || 'Untitled'" data-ng-click="listingsCtrl.filterByIntegration(integration)"></a></li>
                </ul>
            </div>
            <div class="btn-group" uib-dropdown>
                <button type="button" class="btn btn-default dropdown-toggle btn-sm" uib-dropdown-toggle>
                    <i class="fa fa-filter"></i>
                    Filter active:
                    <strong data-ng-if="listingsCtrl.filteredActive===null">All</strong>
                    <strong data-ng-if="listingsCtrl.filteredActive===true">Yes</strong>
                    <strong data-ng-if="listingsCtrl.filteredActive===false">No</strong>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" uib-dropdown-menu>
                    <li><a href="" data-ng-click="listingsCtrl.filterByActive(null)">All</a></li>
                    <li><a href="" data-ng-click="listingsCtrl.filterByActive(true)">Active</a></li>
                    <li><a href="" data-ng-click="listingsCtrl.filterByActive(false)">Inactive</a></li>
                </ul>
            </div>
            <div class="btn-group" uib-dropdown>
                <button type="button" class="btn btn-default dropdown-toggle btn-sm" uib-dropdown-toggle>
                    <i class="fa fa-filter"></i>
                    Filter listed:
                    <strong data-ng-if="listingsCtrl.filteredListed===null">All</strong>
                    <strong data-ng-if="listingsCtrl.filteredListed===true">Listed</strong>
                    <strong data-ng-if="listingsCtrl.filteredListed===false">Unlisted</strong>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" uib-dropdown-menu>
                    <li><a href="" data-ng-click="listingsCtrl.filterByListed(null)">All</a></li>
                    <li><a href="" data-ng-click="listingsCtrl.filterByListed(true)">Listed</a></li>
                    <li><a href="" data-ng-click="listingsCtrl.filterByListed(false)">Unlisted</a></li>
                </ul>
            </div>
            <div class="btn-group" uib-dropdown>
                <button type="button" class="btn btn-default dropdown-toggle btn-sm" uib-dropdown-toggle>
                    <i class="fa fa-filter"></i>
                    Filter city:
                    <strong data-ng-if="!listingsCtrl.filteredCity">All</strong>
                    <strong data-ng-bind="listingsCtrl.filteredCity"></strong> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu right-aligned" role="menu" uib-dropdown-menu>
                    <li><a href="" data-ng-click="listingsCtrl.filterByCity(null)">All</a></li>
                    <li data-ng-repeat="city in listingsCtrl.filterCityOptions" data-ng-click="listingsCtrl.filterByCity(city)">
                        <a href="" data-ng-bind="city"></a>
                    </li>
                </ul>
            </div>
            <div class="btn-group form-inline">
                <div class="input-group">
                    <span class="input-group-addon"><i class="fa fa-search"></i></span>
                    <input type="search" class="form-control" data-ng-model="listingsCtrl.searchTerm" placeholder="Search" data-ng-change="listingsCtrl.load()" ng-model-options='{ debounce: 300 }'>
                </div>
            </div>
        </div>
        <h1>
            Listings
            <span class="badge" data-ng-bind="listingsCtrl.listingsRequest.count"></span>
        </h1>
    </div>
    <div data-ng-repeat="listing in listingsCtrl.listingsRequest.results" class="listing row form-group">
        <div class="col-sm-2">
            <img data-ng-src="{{listing.picture.thumbnail}}" class="width-100-percent">
        </div>
        <div class="col-sm-8">
            <div class="form-group">
                <span data-ng-if="!listing.active" class="label label-danger">Inactive</span>
                <span data-ng-if="!listing.isListed" class="label label-danger">Unlisted</span>
                <span data-ng-if="listing.instantBookable.enabled" class="badge badge-info" title="Instant Book"><i class="fa fa-bolt"></i></span>
                <strong><a data-ui-sref="listing.settings({listingId: listing._id})">{{listing.title || "Untitled"}}</a></strong>
                <div data-ng-if="listing.isVirtual" class="label label-special1">Virtual</div>
                <div data-ng-if="listing.nickname" class="label label-success">{{listing.nickname}}</div>
            </div>
            <div class="form-group">
                {{listing.address.searchable}}
                <div data-ng-if="listing.address.apt">{{listing.address.apt}}</div>
            </div>
            <div>
                <span data-ng-if="listing.roomType" class="label label-warning" data-ng-bind="listing.roomType"></span>
                <span data-ng-if="listing.bedrooms" class="label label-warning">Bedrooms: {{listing.bedrooms}}</span>
                <span data-ng-if="listing.accommodates" class="label label-warning">Max. {{listing.accommodates}} <i class="fa fa-user"></i></span>
            </div>
        </div>
        <div class="col-sm-2 text-right">
            <div class="form-group">
                <a href="https://www.google.com/maps/place/{{listing.address.searchable}}" target="_blank" class="btn btn-default">
                    <i class="fa fa-globe"></i>
                </a>
                <a href="http://www.yelp.com/search?find_desc=&sortby=rating&find_loc={{listing.address.searchable}}" target="_blank" class="btn btn-default">
                    <i class="fa fa-yelp"></i>
                </a>
            </div>
            <div class="form-group">
                <a class="btn btn-default" data-ng-repeat="integration in listing.integrations" title="{{integration.platform}}: {{integrationsById[integration._id].nickname}}" href="{{integration.externalUrl}}" target="_blank" data-ng-bind="integration.platform"></a>
            </div>
        </div>
    </div>
    <div class="text-center" data-ng-show="listingsCtrl.listingsRequest.count > listingsCtrl.limit">
        <uib-pagination ng-model="listingsCtrl.currentPage" items-per-page="listingsCtrl.limit" total-items="listingsCtrl.listingsCount" ng-change="listingsCtrl.load()" next-text="»" previous-text="«" max-size="20"></uib-pagination>
    </div>
</div>
