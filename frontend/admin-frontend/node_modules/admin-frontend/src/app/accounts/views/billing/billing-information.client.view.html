<div ng-controller="BillingInformationController">
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="form-group" ng-if="account.billing.paymentMethods">
                <div>Billing information was set at {{account.billing.createdAt | date:'short'}}</div>
                <div>
                    <strong>Billing cycle:</strong>
                    <div class="btn-group" uib-dropdown>
                        <button type="button" class="btn btn-default dropdown-toggle btn-sm" uib-dropdown-toggle>
                            <span data-ng-bind="account.billing.billingCycle"></span> <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" uib-dropdown-menu>
                            <li><a href="#" data-ng-click="setBillingCycle('Monthly')">Monthly</a></li>
                            <li><a href="#" data-ng-click="setBillingCycle('Bi-Weekly')">Bi-Weekly</a></li>
                            <li><a href="#" data-ng-click="setBillingCycle('Weekly')">Weekly</a></li>
                        </ul>
                    </div>
                </div>
                <div data-ng-if="account.billing.nextBillingDate">
                    <strong>Next billing date:</strong>
                    <span data-ng-bind="account.billing.nextBillingDate | date:'short'"></span>
                    <span class="label label-info" am-time-ago="account.billing.nextBillingDate"></span>
                </div>
            </div>
            <div class="form-group">
                <strong>Available Credit: </strong> {{(account.billing.balance.amount | currency: account.billing.currency) || 0}}
                <button type="button" class="btn btn-default btn-xs" ng-click="addStripeCreditToUser()">Edit Credit</button>
            </div>
            <ul class="list-group" data-ng-repeat="paymentMethod in account.billing.paymentMethods">
                <li class="list-group-item">
                    <span data-ng-if="paymentMethod.paymentFailedAt" class="pull-right label label-danger">Last payment failed</span>
                    <span class="pull-right text-muted"><i class="fa fa-cc-stripe"></i> {{paymentMethod.stripe.id}}</span>
                    <i class="fa fa-credit-card"></i>
                    <strong>{{paymentMethod.stripe.brand}}</strong> {{paymentMethod.stripe.funding}} card, ending with <strong>{{paymentMethod.stripe.last4}}</strong>.
                    (Expires at {{paymentMethod.stripe.exp_month}}/{{paymentMethod.stripe.exp_year}})

                    <span data-ng-if="paymentMethod.isDefault" class="label label-info label-sm">Default</span>
                </li>
            </ul>
            <div data-ng-if="account.freezingFlow">
                <div class="label label-warning">Freezing flow in progress</div>
                <div><strong>Started:</strong> {{account.freezingFlow.started | date:'short'}}</div>
                <div data-ng-repeat="reminder in freezingFlowReminders">
                    <strong>Reminded:</strong> {{reminder | date:'short'}}
                </div>
                <hr>
            </div>
            <div class="form-group" data-ng-if="authentication.isAdmin()">
                <label>Avoid freezing flow</label>
                <label class="switch switch-primary force">
                    <input class="switch-input" name="noFreezingFlow" type="checkbox" data-ng-model="account.billing.noFreezingFlow" data-ng-change="account.$save()">
                    <span class="switch-label" data-off="No" data-on="Yes"></span>
                    <span class="switch-handle"></span>
                </label>
            </div>
            <div class="help-block">
                <i class="fa fa-cc-stripe"></i> {{account.billing.stripeCustomerId || 'None'}}
            </div>
        </div>
    </div>
</div>
