'use strict';

// Accounts controller
angular.module('accounts').controller('BillingController', [
    '$scope',
    '$stateParams',
    'Accounts',
    function($scope, $stateParams, Accounts) {

        $scope.account = Accounts.get({accountId: $stateParams.accountId, fields: 'billing'}, function(){

            var paymentMethodExists = $scope.account && $scope.account.billing && $scope.account.billing.paymentMethods.length>0;

            var failedPayment = paymentMethodExists && !_.isUndefined(_.find($scope.account.billing.paymentMethods, 'paymentFailedAt'));

            $scope.everythingIsOK = paymentMethodExists && !failedPayment;
            $scope.lastInvoiceFailed = paymentMethodExists && failedPayment;
            $scope.noPaymentInfo = !paymentMethodExists;

        });

    }
]);
