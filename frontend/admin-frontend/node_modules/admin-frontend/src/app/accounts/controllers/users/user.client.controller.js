'use strict';

// Accounts controller
angular.module('accounts').controller('UserController', [
    '$scope',
    'User',
    '$stateParams',
    'notify',
    'AppConfig',
    function($scope, User, $stateParams, notify, AppConfig) {

        $scope.user = User.get({userId: $stateParams.userId});

        $scope.loginToUserMyGuesty = function(){
            //set flag to disable clicking again
            $scope.isLoading = true;

            //create a token
            User.generateToken({userId: $scope.user._id}, function(resp){
                window.open(AppConfig.DASHBOARD_URL + '?token=' + resp.token);
                $scope.isLoading = false;

                //todo: Analytics.track('Logged in to My Guesty', {user: $scope.user.fullName, userId: $scope.user._id});
            }, function(err){
                console.error(err);
                $scope.isLoading = false;
                return notify({message:'Error while creating a token', classes: 'alert-danger'});
            });
        };
    }
]);
