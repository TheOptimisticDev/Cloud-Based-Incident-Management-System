'use strict';

// Accounts controller
angular.module('accounts').controller('IntegrationsController', [
    '$scope',
    'SweetAlert',
    'Accounts',
    'Integrations',
    'notify',
    '$state',
    '$uibModal',
    function($scope, SweetAlert, Accounts, Integrations, notify, $state, $uibModal) {

        var self = this;

        self.page = 1;
        self.limit = 25;

        self.loadIntegrations = function() {
            $scope.integrations = Integrations.query({
                accountId: $scope.account._id,
                fields: 'active nickname fullName platform',
                skip: (self.page-1) * self.limit,
                limit: self.limit
            });
        };

        self.addNewAirbnb = function(){
            var integration = new Integrations({
                accountId: $scope.account._id,
                platform: 'airbnb'
            });
            integration.$create(function(integration){
                $state.go('account.integration', {integrationId: integration._id});
                SweetAlert.swal('Integration added successfully. To activate go to Airbnb and change the email.', null, 'success');
            }, function(){
                notify({message:'Error occurred. ask developers.', classes: 'alert-danger'});
            });
        };

        self.addNewRentalsUnited = function(){
            $uibModal.open({
                templateUrl: 'app/integrations/views/create-rentals-united.modal.client.view.html',
                controller: 'CreateNewRentalsUnitedController as ru',
                resolve: {
                    accountId: function() {
                        return $scope.account._id;
                    }
                }
            });
        };
    }
]);
