'use strict';

// Accounts preferences controller
angular.module('accounts').controller('CustomerPreferencesController', [
    '$scope',
    '$state',
    '$stateParams',
    '$location',
    'gNotify',
	function($scope, $state, $stateParams, $location, gNotify) {
		/*********************
		 ***  Preferences  ***
		 *********************/

        (function init() {
            var placeholder = 'Click here to enter content.';
            if(!$scope.account.postBooking) $scope.account.postBooking = placeholder;
            if(!$scope.account.preBooking) $scope.account.preBooking = [];

        })();

		/*********************
		 ***  Pre-booking  ***
		 *********************/

        $scope.newPreBooking = '';
		// Save the account pre-booking
		$scope.saveCustomerPreBooking = function() {
            var preBooking = _.uniq(_.filter($scope.account.preBooking));
            $scope.update({
                preBooking: preBooking
            }).then(function() {
                gNotify.success('Customer pre-booking saved successfully');
            }, function() {
                gNotify.alert('Customer pre-booking saving failed');
            });
		};

        $scope.addedPreBookingItem = function($event){
            if (!$event.currentTarget.innerText) return;
            $scope.account.preBooking.push($event.currentTarget.innerText);
            $event.currentTarget.innerText = '';
        };
        $scope.editedPreBookingItem = function($index, $event){
            $scope.account.preBooking[$index] = $event.currentTarget.innerText;
            if ($event.currentTarget.innerText === ''){
                $scope.account.preBooking.splice($index, 1);
            }
        };


		/**********************
		 ***  Post-Booking  ***
		 **********************/

		// Save the account post-booking
		$scope.saveCustomerPostBooking = function() {
            $scope.update({
                postBooking: $scope.account.postBooking
            }).then(function() {
                gNotify.success('Post-booking saved successfully');
            });
		};
	}
]);
