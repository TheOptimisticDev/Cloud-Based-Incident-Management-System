'use strict';

/**
 * this controller can be opened from $uibModal only. please don't forget to send 'formData' to the modal.
 * data that should be sent at formData: {customer}
 */
angular.module('accounts').controller('DeactivateController', ['$scope', '$uibModalInstance', 'formData', 'Accounts', 'CommonService',
	function($scope, $uibModalInstance, formData, Accounts, CommonService){
		$scope.reasons = [
			'User stops renting',
			'User has long term reservations',
			'User moved to competitors',
			'Price is too high',
			'Upset about human errors',
			'Upset about a technical bug',
			'Product is not what expected',
			'Other'
		];

		$scope.save = function(){
			CommonService.confirm().then(function(){
				var data = {
					accountId: formData.account._id,
					reason: $scope.reason,
					description: $scope.description,
					shouldRevertEmail: $scope.shouldRevertEmail,
					sendCancellationEmail: $scope.sendCancellationEmail
				};
				Accounts.deactivate(data).$promise
				.then(function(){
					formData.account.active = false;
				})
				.catch(function(){
					console.log('failed to save account');
				})
				.finally(function(){
					$uibModalInstance.close(data);
				});
			});
		};
	}
]);
