'use strict';

angular.module('accounts').controller('AddStripeCreditController', function($scope, account, notify, CommonService, Billing) {
    $scope.account = account;
    $scope.credit = {
        amount: account.billing.balance ? account.billing.balance.amount : 0
    };

    // save the credit
    $scope.save = function(event) {
        if (!event) return false;
        if (!$scope.credit.amount) return false;
        $scope.disableBtns = true;
        CommonService.confirm('Add Credit', 'Are you sure you want to add $' + $scope.credit.amount + ' to ' + $scope.account.name + ' account balance?').then(function() {
            Billing.balance({
                accountId: $scope.account._id,
                creditAmount: $scope.credit.amount,
                description: $scope.credit.description
            }, function() {
                notify({
                    message: 'Credit saved successfully',
                    classes: 'alert-success'
                });
                $scope.$close();
            }, function() {
                $scope.$loading = false;
                $scope.disableBtns = false;
                notify({
                    message: 'failed to edit credit',
                    classes: 'alert-danger'
                });
            });
        }, function() {
            $scope.$loading = false;
            $scope.disableBtns = false;
        });
    };

    // close the modal
    $scope.cancel = function() {
        $scope.$dismiss('cancel');
    };
});
