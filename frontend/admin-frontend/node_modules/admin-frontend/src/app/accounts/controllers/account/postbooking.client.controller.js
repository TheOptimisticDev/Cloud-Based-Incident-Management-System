'use strict';

// listings preferences controller
angular.module('accounts').controller('CustomerPostBookingController', [
	'$state',
	'$stateParams',
	'$location',
	'notify',
	'Accounts',
	function($state, $stateParams, $location, notify, Accounts) {

        var self = this;

		self.init = function(){
            self.account = Accounts.get({
                accountId: $stateParams.accountId,
                fields: '_id postBookingService'
            });
		};

		self.saveForm = function(frm, limitTo) {
            if (frm && frm.$invalid) return;

            if (!_.isArray(limitTo)) limitTo = [limitTo];
            var obj = {};
            _.each(limitTo, function(path){
                _.set(obj, path, _.get(self.account, path));
            });

			Accounts.updateApi2({
				accountId: self.account._id
			}, obj, function() {
				notify({
					message: 'Saved successfully',
					classes: 'alert-success'
				});
                if (frm) {
                    frm.$setPristine();
                }
			}, function(){
                notify({
                    message: 'Save failed',
                    classes: 'alert-danger'
                });
                if (frm) {
                    frm.$setPristine();
                }
            });
		};

	}
]);
