'use strict';

// listings preferences controller
angular.module('accounts').controller('CustomerReceptionistsController', [
    '$scope',
    '$state',
    '$stateParams',
    '$location',
    'notify',
    'Accounts',
    function($scope, $state, $stateParams, $location, notify, Accounts) {

        $scope.init = function(){
            $scope.account = Accounts.get({
                accountId: $stateParams.accountId,
                fields: '_id receptionistsService'
            });
        };

        $scope.saveForm = function(frm, limitTo) {
            if (frm && frm.$invalid) return;

            if (!_.isArray(limitTo)) limitTo = [limitTo];
            var obj = {};
            _.each(limitTo, function(path){
                _.set(obj, path, _.get($scope.account, path));
            });

            Accounts.updateApi2({
                accountId: $scope.account._id
            }, obj, function() {
                notify({
                    message: 'Saved successfully',
                    classes: 'alert-success'
                });
                if (frm) {
                    frm.$setPristine();
                }
            }, function(){
                notify({
                    message: 'Save failed',
                    classes: 'alert-danger'
                });
                if (frm) {
                    frm.$setPristine();
                }
            });
        };

        $scope.setValue = function(key, value, frm){
            _.set($scope.listing, key, value);
            if (frm) {
                frm.$setDirty();
            }
        };
    }
]);
