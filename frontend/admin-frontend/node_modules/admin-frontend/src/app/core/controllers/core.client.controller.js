(function(){
    'use strict';

    angular.module('core').controller('CoreController', CoreController);

    /** @ngInject **/
    function CoreController(Authentication, Employees, Events, $rootScope) {

        var self = this;

        self.auth = null;
        self.employee = null;

        self.init = init;

        /////////////////////////

        function init(){
            // //if user is logged in
            if (Authentication.isLoggedIn()){

                //expose auth object
                self.auth = Authentication.getTokenObject();

                //get employee details
                $rootScope.employee = self.employee = Employees.me({fields:'username fullName presentableName picture roles preferences'}, function(){
									// FIXME: causing free
                   Events.emit('employee.loaded', self.employee);

                    //todo: move to listeners
                   Authentication.setEmployee(self.employee);
                   Raven.setUserContext(self.employee);
                    ////
                });
            } else {
                Authentication.goToLoginPage();
            }
        }


    }

})();
